---
# tasks file for production
- name: Install packages
  apt:
    pkg:
      - docker.io
      - python3-pip
    update_cache: yes
    state: present

- name: Pip install docker
  pip:
    name: docker

- name: Create a volume
  community.docker.docker_volume:
    name: volume

- name: Start a temporary container build
  community.docker.docker_container:
    name: temporary_build
    state: started
    image: syrkashevav/build:v1.0
    volumes:
      - volume:/warfile

- name: Start conteiner tomcat
  community.docker.docker_container:
    name: tomcat
    state: started
    image: tomcat:9.0.20-jre8-alpine
    volumes:
      - volume:/warfile
    ports: 8081:8080

- name: This command will change the working directory to somedir/
  ansible.builtin.shell:
    cmd: ls -l
    chdir: /var/lib/docker/volumes/

- name: This command will change the working directory to somedir/
  ansible.builtin.shell:
    cmd: ls -l | grep hell0-1.0.war
    chdir: warfile/

- name: Copying an artifact
  ansible.builtin.copy:
    src: /warfile/hello-1.0.war
    dest: /usr/local/tomcat/webapps
    follow: yes

- name: Remove a temporary container build
  become: yes
  docker_container:
    name: temporary_build
    state: absent

- name: Remove an image on Docker Hub
  community.docker.docker_image:
    name: syrkashevav/build
    tag: v1.0
    state: absent
