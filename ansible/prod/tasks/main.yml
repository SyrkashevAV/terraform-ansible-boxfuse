---
# tasks file for prod
- name: install packages
  apt:
    pkg:
      - docker.io
      - python3-pip
    update_cache: yes
    state: present

- name: pip install docker
  pip:
    name: docker

- name: Create a volume
  community.docker.docker_volume:
    name: volume

- name: start conteiner build
  community.docker.docker_container:
    name: build
    state: started
    image: syrkashevav/build:v1.0
    volumes:
      - volume:/war

- name: start conteiner run
  community.docker.docker_container:
    name: run
    state: started
    image: tomcat:9.0.20-jre8-alpine
    volumes:
      - volume:/tmp/war
    ports: 8084:8080

- name: Copying an artifact
  ansible.builtin.copy:
    src: /tmp/war/hello-1.0.war
    dest: /usr/local/tomcat/webapps/
    follow: yes
